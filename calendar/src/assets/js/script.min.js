document.addEventListener("DOMContentLoaded",function(){let userTimezone=Intl.DateTimeFormat().resolvedOptions().timeZone;let calendarEl=document.getElementById("calendar");let calendar=new FullCalendar.Calendar(calendarEl,{views:{timeGridWeek:{allDaySlot:false},timeGridDay:{allDaySlot:false}},initialView:"timeGridWeek",timeZone:"local",events:"src/get-events.php",headerToolbar:{left:"prev,today,next",center:"title",right:"timeGridWeek,timeGridDay"},editable:true,selectable:true,selectAllow:function(selectInfo){let startDate=moment(selectInfo.start);let endDate=moment(selectInfo.end);return startDate.isSame(endDate,"day")},select:function(info){$("#eventModal").modal("show");$("#deleteEventButton").hide();$("#eventModal").off("show.bs.modal");$("#eventModal").on("show.bs.modal",function(){resetFormValidation();$("#eventTitle").val("");$("#eventCategory option:first").prop("selected",true);let firstOption=$("#eventCategory option:first");firstOption.prop("selected",true);let selectedColor=firstOption.data("color");$("#selectedColor").css("background-color",selectedColor);$("#selectedColor").show();$("#eventId").val("")});$("#updateEventBtn").remove();$("#saveEventBtn").remove();let saveButton=$("<button>",{type:"button",class:"btn btn-success",id:"saveEventBtn",text:"Save"});$("#buttonContainer").append(saveButton);saveButton.on("click",function(){let eventForm=document.getElementById("eventForm");if(eventForm.checkValidity()){console.log("Form is valid. Add the event here.")}else{eventForm.classList.add("was-validated")}});$("#saveEventBtn").on("click",function(){let eventTitle=$("#eventTitle").val();let selectedStartDate=$("#eventModal").attr("data-start");let selectedEndDate=$("#eventModal").attr("data-end");let eventCategory=$("#eventCategory").val();let color=$("#eventCategory option:selected").data("color");$.ajax({type:"POST",url:"src/add-event.php",data:{title:eventTitle,start:selectedStartDate,end:selectedEndDate,color:color,category:eventCategory},success:function(response){console.log("Event saved successfully.");$("#eventModal").modal("hide");calendar.refetchEvents()},error:function(xhr,status,error){console.error("Error saving event:",error)}})});$(".modal-title").text("Add Event");let selectedStartDate=info.startStr;let selectedEndDate=info.endStr;$("#eventModal").attr("data-start",selectedStartDate);$("#eventModal").attr("data-end",selectedEndDate);calendar.refetchEvents()},eventChange:function(changeInfo){let newStartDate=moment(changeInfo.event.start);let newEndDate=moment(changeInfo.event.end);if(!newStartDate.isSame(newEndDate,"day")){alert("Event start and end must reside on the same day.");changeInfo.revert()}else{moveEvents(changeInfo.event,"moveEvent")}},eventClick:function(info){resetFormValidation();let event=info.event;let title=info.event.title;let category=event.extendedProps.category;$("#eventModal").modal("show");$(".modal-title").text("Update Event");$("#deleteEventButton").show();$("#eventId").val(event.id);$("#eventTitle").val(title.toString());let eventBackgroundColor=info.event.backgroundColor;$("#selectedColor").css("background-color",eventBackgroundColor);$("#selectedColor").show();$("#eventCategory").find('option[value="'+category.trim()+'"]').prop("selected",true);$("#saveEventBtn").remove();$("#updateEventBtn").remove();let updateButton=$("<button>",{type:"button",class:"btn btn-success",id:"updateEventBtn",text:"Update"});$("#buttonContainer").append(updateButton);updateButton.on("click",function(){let eventForm=document.getElementById("eventForm");if(eventForm.checkValidity()){console.log("Form is valid. Add the event here.")}else{eventForm.classList.add("was-validated")}});$("#updateEventBtn").on("click",function(){let eventTitle=$("#eventTitle").val();let eventColor=$("#eventCategory option:selected").data("color");let eventCategory=$("#eventCategory").val();let eventId=$("#eventId").val();$.ajax({type:"POST",url:"src/update-event.php",data:{id:eventId,title:eventTitle,color:eventColor,category:eventCategory},success:function(response){console.log("Event updated successfully.");$("#eventModal").modal("hide");calendar.refetchEvents()},error:function(xhr,status,error){console.error("Error updating event:",error)}})})}});$("#eventModal").on("hide.bs.modal",function(){$("#eventTitle").val("");$("#eventCategory option:first").prop("selected",true);$("#selectedColor").hide();$("#eventId").val("")});$("#selectColor").hide();calendar.render();function moveEvents(event,actionType=null){let eventTitle=event.title;let newStartDate=moment(event.start);let newEndDate=moment(event.end);let formattedStartDate=newStartDate.format("YYYY-MM-DD HH:mm:ss");let formattedEndDate=newEndDate.format("YYYY-MM-DD HH:mm:ss");$.ajax({type:"POST",url:"src/update-event.php",data:{id:event.id,title:eventTitle,start:formattedStartDate,end:formattedEndDate,actionType:actionType},success:function(response){console.log("Event updated successfully.")},error:function(xhr,status,error){console.error("Error updating event title:",error)}})}let deleteEventButton=$("#deleteEventButton");deleteEventButton.on("click",function(event){event.preventDefault();if(confirm("Delete event?")){let eventId=$("#eventId").val();$.ajax({url:"src/delete-event.php",type:"POST",data:{id:eventId},success:function(response){let event=calendar.getEventById(eventId);if(event){event.remove();console.log("Event deleted successfully.")}$("#eventModal").modal("hide")},error:function(xhr,status,error){console.log(xhr.responseText)}})}});function resetFormValidation(){let eventForm=document.getElementById("eventForm");eventForm.classList.remove("was-validated")}});