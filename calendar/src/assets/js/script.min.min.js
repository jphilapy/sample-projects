document.addEventListener("DOMContentLoaded",function(){let userTimezone=Intl.DateTimeFormat().resolvedOptions().timeZone;let calendarEl=document.getElementById("calendar");let calendar=new FullCalendar.Calendar(calendarEl,{views:{timeGridWeek:{allDaySlot:false},timeGridDay:{allDaySlot:false}},initialView:"timeGridWeek",timeZone:"local",events:"src/get-events.php",headerToolbar:{left:"prev,today,next",center:"title",right:"timeGridWeek,timeGridDay"},editable:true,selectable:true,selectAllow:function(selectInfo){let startDate=moment(selectInfo.start);let endDate=moment(selectInfo.end);return startDate.isSame(endDate,"day")},select:function(info){console.log("select");$("#eventModal").modal("show");$("#deleteEventButton").hide();$("#eventModal").on("show.bs.modal",function(){$("#eventTitle").val("");$("#eventId").val("")});$(".modal-title").text("Add Event");let selectedStartDate=info.startStr;let selectedEndDate=info.endStr;$("#eventModal").attr("data-start",selectedStartDate);$("#eventModal").attr("data-end",selectedEndDate);calendar.refetchEvents()},eventChange:function(changeInfo){console.log("eventChange");let newStartDate=moment(changeInfo.event.start);let newEndDate=moment(changeInfo.event.end);if(!newStartDate.isSame(newEndDate,"day")){alert("Event start and end must reside on the same day.");changeInfo.revert()}else{updateEventOnServer(changeInfo.event)}},eventClick:function(info){console.log("eventClick");let event=info.event;let title=info.event.title;$("#eventModal").modal("show");$(".modal-title").text("Update Event");$("#deleteEventButton").show();$("#eventId").val(event.id);$("#eventTitle").val(title.toString());$("#saveEventBtn").remove();$("#updateEventBtn").remove();let updateButton=$("<button>",{type:"button",class:"btn btn-success",id:"updateEventBtn",text:"Update"});$("#buttonContainer").append(updateButton);$("#updateEventBtn").on("click",function(){let eventTitle=$("#eventTitle").val();let eventId=$("#eventId").val();$.ajax({type:"POST",url:"src/update-event.php",data:{id:eventId,title:eventTitle},success:function(response){console.log("Event updated successfully.");$("#eventModal").modal("hide");calendar.refetchEvents()},error:function(xhr,status,error){console.error("Error updating event:",error)}})})}});calendar.render();function updateEventOnServer(event){let eventTitle=event.title;let newStartDate=moment(event.start);let newEndDate=moment(event.end);let formattedStartDate=newStartDate.format("YYYY-MM-DD HH:mm:ss");let formattedEndDate=newEndDate.format("YYYY-MM-DD HH:mm:ss");$.ajax({type:"POST",url:"src/update-event.php",data:{id:event.id,title:eventTitle,start:formattedStartDate,end:formattedEndDate},success:function(response){console.log("Event updated successfully.")},error:function(xhr,status,error){console.error("Error updating event title:",error)}})}let deleteEventButton=$("#deleteEventButton");deleteEventButton.on("click",function(event){event.preventDefault();console.log("delete");if(confirm("Delete event?")){let eventId=$("#eventId").val();$.ajax({url:"src/delete-event.php",type:"POST",data:{id:eventId},success:function(response){let event=calendar.getEventById(eventId);if(event){event.remove();console.log("Event deleted successfully.")}$("#eventModal").modal("hide")},error:function(xhr,status,error){console.log(xhr.responseText)}})}});$("#saveEventBtn").on("click",function(){let eventTitle=$("#eventTitle").val();let selectedStartDate=$("#eventModal").attr("data-start");let selectedEndDate=$("#eventModal").attr("data-end");$.ajax({type:"POST",url:"src/add-event.php",data:{title:eventTitle,start:selectedStartDate,end:selectedEndDate},success:function(response){console.log("Event saved successfully.");$("#eventModal").modal("hide");calendar.refetchEvents()},error:function(xhr,status,error){console.error("Error saving event:",error)}})})});